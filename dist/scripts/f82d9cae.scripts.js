angular.module("cohortsApp",["ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{data:["$q","$http",function(a,b){var c=a.defer();return b.get("scripts/json/data.json").success(function(a){c.resolve(a)}).error(function(){c.reject("failed to load json")}),c.promise}]}})}]),angular.module("cohortsApp").controller("MainCtrl",["$scope","data",function(a,b){a.data=b,a.selectedStat="HealthScore";for(var c=0,d=a.data.length;d>c;c++){5>c&&(a.data[c].visible=!0);for(var e=0,f=a.data[c].historicalData.length;f>e;e++)a.data[c].historicalData[e].eventId=Math.random().toString(36).substring(7)}}]),angular.module("cohortsApp").directive("cohortsChart",["$filter","$timeout","$compile",function(a,b,c){return{templateUrl:"partials/cohortsChart.html",restrict:"E",scope:{data:"=data",selectedStat:"=selectedStat"},replace:!0,link:{pre:function(b,c){b.margin={top:10,right:10,bottom:20,left:40},b.elem=$(c),b.width=b.elem.width(),b.height=b.elem.height(),b.x,b.y,b.xAxis,b.yAxis,b.xAxisGroup,b.yAxisGroup,b.svg,b.cohorts,b.x=d3.scale.linear().range([0,b.width-b.margin.left-b.margin.right]),b.y=d3.scale.pow().exponent(2).range([b.height-b.margin.top-b.margin.bottom,0]),b.xAxis=d3.svg.axis().scale(b.x).tickFormat(function(a){return a%30==0?a:null}).orient("bottom"),b.yAxis=d3.svg.axis().scale(b.y).tickSize(10,4,-10).ticks(20).tickFormat(function(a){return a%25==0?a+"%":null}).orient("left"),b.line=d3.svg.line().x(function(a){return b.x(a.day)}).y(function(a){return b.y(a[b.selectedStat])}).interpolate("cardinal"),b.svg=d3.select(c[0]).append("svg").attr("width",b.width).attr("height",b.height).append("g").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),b.xAxisGroup=b.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(b.height-b.margin.bottom-b.margin.top)+")"),b.yAxisGroup=b.svg.append("g").attr("class","y axis"),b.cohortsContainer=b.svg.append("g").attr("class","cohorts"),b.cohorts=b.cohortsContainer.selectAll("g.cohort").data(b.data).enter().append("g").attr("class","cohort"),b.cohorts.append("path").attr("d",function(a){return b.line(a.historicalData)}),b.cohorts.each(function(b){var c=a("filter")(b.historicalData,function(a){return a.Event});d3.select(this).selectAll("circle").data(c).enter().append("circle").attr("class",function(a){return"event event-"+a.Event})}),b.events=b.cohorts.selectAll("circle").attr("r",20).attr("tooltip-append-to-body",!0).attr("tooltip",function(a){return a.Event+" ("+a.day+" day"+(a.day>1?"s)":")")}).attr("opacity",0).on("mouseenter",function(){d3.select(this).transition().duration(100).attr("r",10)}).on("mouseleave",function(){d3.select(this).transition().duration(100).attr("r",3)})},post:function(a,d){function e(a){a.attr("stroke-dasharray",function(){var a=d3.select(this).node().getTotalLength();return a+" "+a}).attr("stroke-dashoffset",function(){return d3.select(this).node().getTotalLength()})}function f(a){e(a),a.transition().duration(1e3).ease("sin").attr("stroke-dashoffset",0).style("opacity",1)}function g(a){a.transition().duration(250).style("opacity",0).attr("stroke-dasharray",function(){var a=d3.select(this).node().getTotalLength();return a+" "+a}).attr("stroke-dashoffset",function(){return d3.select(this).node().getTotalLength()})}a.render=function(h){a.x.domain([0,90]),a.y.domain([0,100]),a.xAxisGroup.call(a.xAxis),a.yAxisGroup.call(a.yAxis),h&&(a.cohorts.selectAll("path").attr("d",function(b){return a.line(b.historicalData)}).each(function(a,c,d){var g=d3.select(this);e(g),b(function(){f(g)},250*d)}),b(function(){a.events.attr("cx",function(b){return a.x(b.day)}).attr("cy",function(b){return a.y(b[a.selectedStat])}).transition().duration(500).attr("opacity",1).attr("r",3)},1250+250*a.cohorts.length)),a.cohorts.each(function(a){if(a.visible){if(a.visible&&d3.select(this).select("path").style("opacity")<1){var c=this;f(d3.select(this).select("path")),b(function(){d3.select(c).selectAll("circle").transition().duration(500).attr("opacity",1).attr("r",3)},1e3)}}else g(d3.select(this).select("path")),d3.select(this).selectAll("circle").transition().duration(250).attr("opacity",0).attr("r",20)}).selectAll("path").attr("d",function(b){return a.line(b.historicalData)}),c(d)(a)},a.$watch(function(){return a.selectedStat},function(b,c){angular.equals(b,c)||a.render(!0)}),a.$watch(function(){return a.data},function(b,c){angular.equals(b,c)||a.render(!1)},!0),a.render(!0)}}}}]),angular.module("cohortsApp").directive("cohortsFeed",function(){return{templateUrl:"partials/cohortsFeed.html",restrict:"E",scope:{data:"=data"},link:function(){}}});