function drawStatus(a){function b(a){var b,c,d;return b=new Date(a.replace("+","").substring(0,a.length-4)+"Z"),d="AM",c=b.getHours()>12?b.getHours()-12:b.getHours(),b.getHours>=12&&(d="PM"),("0"+(b.getMonth()+1)).slice(-2)+"/"+("0"+b.getDate()).slice(-2)+"/"+("0"+b.getFullYear()).slice(-2)+" "+("0"+c).slice(-2)+":"+("0"+b.getSeconds()).slice(-2)+" "+d}function c(a){var b,c,d,e,a=a||0,f=new Date(1e3*a);if(b=f.getDay(),c=f.getHours(),d=f.getMinutes(),e=f.getSeconds(),b>1)return b+" days";var g="";return 1==b&&(c+=24),g+=("0"+c).slice(-2)+":"+("0"+d).slice(-2)+":"+("0"+e).slice(-2)}function d(a){if(!a.start_date)return{code:"inactive",code_verbose:"INACTIVE",display:"Not Started",iconClass:"pause",sortCode:0};if(a.start_date&&a.end_date){if(a.total!==a.processed)return{code:"error",code_verbose:"ERROR",display:"Halted: "+b(a.end_date),iconClass:"remove",sortCode:1};if(a.total===a.processed)return{code:"success",code_verbose:"SUCCESS",display:"Completed: "+b(a.end_date),iconClass:"ok",sortCode:2}}else if(a.start_date&&!a.end_date&&a.total!==a.processed)return{code:"in_progress",code_verbose:"IN PROGRESS",display:'Time Remaining: <span class="timer" data-time="'+a.remaining+'">'+c(a.remaining)+"</span>",iconClass:"play",sortCode:3};return{code:"malformed",code_verbose:"MALFORMED",display:"Malformed Record: "+a.id,iconClass:"minus-sign",sortCode:4}}function e(a){var b=a.status;return b=b.replace(/success/gi,function(a){return'<strong class="text-success">'+a+"</strong>"}),b=b.replace(/fail|error/gi,function(a){return'<strong class="text-danger">'+a+"</strong>"})}function f(a){var b=1024;if(b>a)return a+" B";var c=["kB","mB","gB","tB","pB","eB","zB","yB"],d=-1;do a/=b,++d;while(a>=b);return a.toFixed(2)+" "+c[d]}clearInterval(j);var g,h,i,j;g=$("#data-list"),h=a||{},g.html('<li class="list-group-item row"><div class="icon"></div><div class="data-container"><div class="status">Status</div><div class="prgrss">Progress</div><div class="user">User</div><div class="date">Request Date</div></div></li>'),$("#fileCount").html("&nbsp;<small>"+h.DATA.length+" records</small>"),h.DATA.length>200&&$("#fileCount small").append(" - we need pagination!");for(var k=0,l=h.DATA.length;l>k;k++)h.DATA[k].statusObj=d(h.DATA[k]);h.DATA.sort(function(a,b){if(a.statusObj.sortCode!==b.statusObj.sortCode)return a.statusObj.sortCode-b.statusObj.sortCode;var c=new Date(a.request_date.replace("+","").substring(0,a.request_date.length-4)).getTime(),d=new Date(b.request_date.replace("+","").substring(0,b.request_date.length-4)).getTime();return c-d});for(var k=0,l=h.DATA.length;l>k;k++){var m,n,o,p,q;record=h.DATA[k],n=record.statusObj,m='<span class="glyphicon glyphicon-'+n.iconClass+'"></span>',statusMsg=e(record),o=f(record.processed||0)+" / "+f(record.total||0),p='<a href="mailto:'+record.email+'">'+record.username+"</a>",q=record.request_date,g.append('<li id="'+record.id+'" class="list-group-item row"><div class="icon '+n.code+'">'+m+'</div><div class="data-container row"><div class="status"><span class="status-title">'+n.display+'</span></div><div class="prgrss">'+o+'</div><div class="user">'+p+'</div><div class="date">'+b(q)+'</div></div><div class="row"><div class="status-message">'+statusMsg+"</div></div></li>")}if(i=$("span[data-time]"),i.length>0){var r=0;j=setInterval(function(){r++;for(var a=0,b=i.length;b>a;a++)$(i[a]).html(c($(i[a]).attr("data-time")-r))},1e3,0)}}function handleError(a){dismissError();var b=a||"There was an error.";$("#fileInfo").after('<div class="alert alert-danger alert-dismissable" id="error"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Oops!</strong> '+b+"</div>")}function dismissError(){$("#error").remove()}$(function(){function a(a){var b=a.originalEvent;b.stopPropagation(),b.preventDefault(),b.dataTransfer.dropEffect="copy"}function b(a){a.preventDefault(),a.stopPropagation();var b=a.originalEvent;c(b.dataTransfer.files)}function c(a){$("#fileCount").html("&nbsp;<small>Loading...</small>");var b=new FileReader;dismissError(),$("#fileName").html(a[0].name),b.onload=function(a){try{result=$.parseJSON(a.srcElement.result),drawStatus(result)}catch(b){return $("#data-list").html(""),$("#fileCount").html(""),console.trace(b),void handleError("There was an error with the formatting of the supplied JSON file.")}},b.onerror=function(){handleError("There was an error reading the supplied JSON file.")},b.readAsText(a[0])}$("#fileDrop").on("dragover",a).on("drop",b).on("click",function(){$("#file").trigger("click")}),$("#file").on("change",function(a){c(a.target.files)})});